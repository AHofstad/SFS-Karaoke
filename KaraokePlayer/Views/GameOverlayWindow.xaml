<Window x:Class="KaraokePlayer.Views.GameOverlayWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:converters="clr-namespace:KaraokePlayer.Converters"
        xmlns:controls="clr-namespace:KaraokePlayer.Controls"
        WindowStyle="None"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True">
  <Window.Resources>
    <converters:PercentToWidthConverter x:Key="PercentToWidthConverter" />
    <converters:WidthFractionConverter x:Key="WidthFractionConverter" />
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    <sys:Double x:Key="GameOverlayWidth">320</sys:Double>
    <sys:Double x:Key="GameOverlayHeight">84</sys:Double>
    <CornerRadius x:Key="GameOverlayCornerRadius">14</CornerRadius>
    <CornerRadius x:Key="GameProgressCornerRadius">10</CornerRadius>
    <sys:Double x:Key="GameOverlayProgressHeight">26</sys:Double>
    <sys:Double x:Key="GameTitleFontSize">26</sys:Double>
    <sys:Double x:Key="GameTimeFontSize">26</sys:Double>
    <sys:Double x:Key="GameTitleStrokeThickness">1.4</sys:Double>
    <CornerRadius x:Key="GameTitleCornerRadius">18</CornerRadius>
    <SolidColorBrush x:Key="GameTitlePanelBrush" Color="#66000000" />
    <SolidColorBrush x:Key="GameProgressPanelBrush" Color="#66000000" />
    <SolidColorBrush x:Key="GameProgressFillBrush" Color="#1C4F8A" />
    <sys:Double x:Key="GameTimeStrokeThickness">1.4</sys:Double>
    <sys:Double x:Key="GameLyricStrokeThickness">2</sys:Double>
    <sys:Double x:Key="GameNextLyricStrokeThickness">1.6</sys:Double>

    <Style TargetType="ProgressBar" x:Key="RoundedProgressBar">
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="ProgressBar">
            <Grid>
              <Border Background="#0B0B0C"
                      CornerRadius="{StaticResource GameProgressCornerRadius}"
                      BorderBrush="#88FFFFFF"
                      BorderThickness="1" />
              <Border CornerRadius="{StaticResource GameProgressCornerRadius}" ClipToBounds="True">
                <Border x:Name="PART_Indicator"
                        Background="{TemplateBinding Foreground}"
                        HorizontalAlignment="Left"
                        CornerRadius="{StaticResource GameProgressCornerRadius}" />
              </Border>
            </Grid>
            <ControlTemplate.Triggers>
              <Trigger Property="IsIndeterminate" Value="True">
                <Setter TargetName="PART_Indicator" Property="Width" Value="0" />
              </Trigger>
              <Trigger Property="Orientation" Value="Horizontal">
                <Setter TargetName="PART_Indicator" Property="Width">
                  <Setter.Value>
                    <MultiBinding Converter="{StaticResource PercentToWidthConverter}">
                      <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="ActualWidth" />
                      <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="Value" />
                      <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="Maximum" />
                    </MultiBinding>
                  </Setter.Value>
                </Setter>
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
  </Window.Resources>
  <Grid Margin="24">
    <StackPanel Orientation="Horizontal"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="0,0,0,0">
      <Border Height="{StaticResource GameOverlayHeight}"
              Background="{StaticResource GameProgressPanelBrush}" CornerRadius="{StaticResource GameOverlayCornerRadius}"
              Width="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ActualWidth, Converter={StaticResource WidthFractionConverter}, ConverterParameter=0.333}">
        <Grid Margin="16">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <ProgressBar x:Name="GameProgressBar"
                       Height="{StaticResource GameOverlayProgressHeight}"
                       Maximum="100"
                       Value="{Binding RemainingProgress}"
                       Foreground="{StaticResource GameProgressFillBrush}"
                       VerticalAlignment="Center"
                       Style="{StaticResource RoundedProgressBar}" />
          <Slider x:Name="GameScrubSlider"
                  Height="{StaticResource GameOverlayProgressHeight}"
                  Minimum="0"
                  Maximum="100"
                  Value="{Binding RemainingProgress, Mode=OneWay}"
                  Opacity="0.01"
                  IsMoveToPointEnabled="True"
                  VerticalAlignment="Center"
                  PreviewMouseLeftButtonDown="GameScrubSlider_PreviewMouseLeftButtonDown"
                  PreviewMouseLeftButtonUp="GameScrubSlider_PreviewMouseLeftButtonUp" />
          <controls:OutlinedTextBlock x:Name="GameElapsedTimeText"
                                      Grid.Column="1"
                                      Text="{Binding ElapsedTime}"
                                      Fill="White"
                                      Stroke="Black"
                                      StrokeThickness="{StaticResource GameTimeStrokeThickness}"
                                      FontSize="{StaticResource GameTimeFontSize}"
                                      Margin="12,0,0,0"
                                      VerticalAlignment="Center"
                                      FontWeight="Bold" />
        </Grid>
      </Border>

      <controls:OutlinedTextBlock x:Name="GameSkipPromptText"
                                  Text="{Binding SkipPromptText}"
                                  Fill="White"
                                  Stroke="Black"
                                  StrokeThickness="{StaticResource GameTimeStrokeThickness}"
                                  FontSize="20"
                                  Margin="12,0,0,0"
                                  VerticalAlignment="Center"
                                  Visibility="{Binding IsSkipPromptVisible, Converter={StaticResource BoolToVisibility}}" 
                                  FontWeight="Bold"/>
    </StackPanel>

    <Border Background="{StaticResource GameTitlePanelBrush}" CornerRadius="{StaticResource GameTitleCornerRadius}"
            HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="0" Padding="18,12">
      <StackPanel Orientation="Horizontal">
        <controls:OutlinedTextBlock x:Name="GameSongArtistText"
                                    Text="{Binding SongArtist}"
                                    Fill="White"
                                    Stroke="Black"
                                    StrokeThickness="{StaticResource GameTitleStrokeThickness}"
                                    FontSize="{StaticResource GameTitleFontSize}"
                                    FontWeight="Bold" />
        <controls:OutlinedTextBlock x:Name="GameSongSeparatorText"
                                    Text=" - "
                                    Fill="White"
                                    Stroke="Black"
                                    StrokeThickness="{StaticResource GameTitleStrokeThickness}"
                                    FontSize="{StaticResource GameTitleFontSize}"
                                    FontWeight="Bold" />
        <controls:OutlinedTextBlock x:Name="GameSongTitleText"
                                    Text="{Binding SongTitle}"
                                    Fill="White"
                                    Stroke="Black"
                                    StrokeThickness="{StaticResource GameTitleStrokeThickness}"
                                    FontSize="{StaticResource GameTitleFontSize}"
                                    FontWeight="Bold" />
      </StackPanel>
    </Border>

    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="960">
      <ItemsControl ItemsSource="{Binding CurrentLyricTokens}" Margin="0,0,0,12">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel HorizontalAlignment="Center" />
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <controls:OutlinedTextBlock x:Name="CurrentLyricTokenText"
                                        Text="{Binding Text}"
                                        Stroke="Black"
                                        StrokeThickness="{StaticResource GameLyricStrokeThickness}"
                                        FontSize="42"
                                        FontWeight="SemiBold">
              <controls:OutlinedTextBlock.Style>
                <Style TargetType="controls:OutlinedTextBlock">
                  <Setter Property="Fill" Value="White" />
                  <Setter Property="LayoutTransform">
                    <Setter.Value>
                      <ScaleTransform ScaleX="1" ScaleY="1" />
                    </Setter.Value>
                  </Setter>
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                      <Setter Property="Fill" Value="#FFD43B" />
                      <Setter Property="Underline" Value="True" />
                      <Setter Property="UnderlineThickness" Value="3" />
                      <Setter Property="FontWeight" Value="Bold" />
                      <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
                      <Setter Property="LayoutTransform">
                        <Setter.Value>
                          <ScaleTransform ScaleX="1.12" ScaleY="1.12" />
                        </Setter.Value>
                      </Setter>
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </controls:OutlinedTextBlock.Style>
            </controls:OutlinedTextBlock>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
      <controls:OutlinedTextBlock x:Name="NextLyricLineText"
                                  Text="{Binding NextLyricLineText}"
                                  Fill="White"
                                  Stroke="Black"
                                  StrokeThickness="{StaticResource GameNextLyricStrokeThickness}"
                                  FontSize="36"
                                  TextAlignment="Center"
                                  TextWrapping="Wrap" />
    </StackPanel>
  </Grid>
</Window>
